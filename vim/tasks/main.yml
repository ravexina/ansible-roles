---
# tasks file for vim

- name: install vim/git
  apt:
    name:
      - vim
      - git
    state: latest
    update_cache: yes
  become: yes

- name: Ensure .vim/{autoload,swaps} directory exists
  file:
    path: "{{ item }}"
    state: directory
    recurse: no
    mode: 0750
  loop:
      - "{{ vim_dir }}"
      - "{{ vim_dir }}/autoload/"
      - "{{ vim_dir }}/swaps/"

- name: Ensure vim-plug is installed
  block:
    - name: Install vim-plug using url
      get_url:
        url: https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
        dest: "{{ vim_dir }}/autoload/plug.vim"
  rescue:
    - name: Install vim-plug using copy
      copy:
        src: plug.vim
        dest: "{{ vim_dir }}/autoload/plug.vim"
        mode: 0640

- name: copy vimrc
  copy:
    dest: "{{ vimrc }}"
    src: vimrc
    mode: 0640
    backup: yes

- name: copy Plugins and Plugin configuration file
  copy:
    dest: "{{ vim_dir }}/{{ item }}"
    src: "{{ item }}"
    mode: 0640
    backup: yes
  loop:
    - plugins.vim
    - plugins_config.vim

- name: run PlugInstall
  command:
    cmd: "vim +'PlugInstall --sync' +qa"

- name: enable nord theme
  replace:
    path: "{{ vimrc }}"
    regexp: '" colorscheme nord'
    replace: 'colorscheme nord'
